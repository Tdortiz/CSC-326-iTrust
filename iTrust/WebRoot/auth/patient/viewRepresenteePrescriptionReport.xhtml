<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core">

<h:body>
	<ui:composition template="/iTrust_template.xhtml">
		<ui:define name="pageStyle">
			<link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" />
		</ui:define>
		<ui:define name="pageTitle">View My Prescription Report</ui:define>
		<ui:define name="leftMenu"><ui:include src="/auth/patient/menu.jsp" /></ui:define>
		
		<ui:define name="mainContent">
			<div align="center">
				<h:message for="" class="iTrustError" />
				<br />
				<h2 style="font-size: 175%; font-weight: bold;">Prescription Report</h2>
				<br />
				
				<!--  Display who the current user represents -->
				<c:set var="representeeList" value="#{prescription_controller.getListOfRepresentees()}" />
				<c:choose>
					<c:when test="${!empty representeeList}">
						<h:dataTable styleClass="fTable" var="pat" value="#{representeeList}" border="1">
							<f:facet name="header">
								<h:outputText value="Patients" />
							</f:facet>
							
							<h:column>
								<h:link value="#{pat.getFullName()}">
									<f:param name="rep" value="#{representeeList.indexOf(pat)}" />
								</h:link>
							</h:column>
						</h:dataTable>
						<br /><br />
						
						<c:set var="representeeIndex" value="#{ prescription_controller.getRepParameter() }" /> 
						<c:set var="representeeMID"   value="#{ representeeList.get(representeeIndex).getMID() }" />
						<c:set var="prescriptionList" value="#{ prescription_controller.getPrescriptionsByPatientID(representeeMID) }" />
						<c:choose>
							<c:when test="${!empty prescriptionList and !empty representeeList}">
								<h:dataTable styleClass="fTable dt-compat" value="#{ prescriptionList }" var="prescription" border="1">							
									<f:facet name="header">#{representeeList.get(representeeIndex).getFullName()}</f:facet>
									<h:column>
										<f:facet name="header">Medication</f:facet>
										<h:outputText value="#{prescription.getCode()}" />
									</h:column>
									
									<h:column>
										<f:facet name="header">Date Prescribed</f:facet>
										<h:outputText value="#{prescription.startDate}" />
									</h:column>
									
									<h:column>
										<f:facet name="header">Start Date</f:facet>
										<h:outputText value="#{prescription.startDate}" />
									</h:column>
									
									<h:column>
										<f:facet name="header">End Date</f:facet>
										<h:outputText value="#{prescription.endDate}" />
									</h:column>
									
									<h:column>
										<f:facet name="header">HCP Name</f:facet>
										<h:outputText value="#{user.getUserNameForID(prescription.hcpMID)}" />
									</h:column>
								</h:dataTable>
							</c:when>
							<c:otherwise>
								No Prescriptions
							</c:otherwise>
						</c:choose>
						
					</c:when>
					<c:otherwise>
						You Have No Representees
					</c:otherwise>
				</c:choose>
			</div>
		</ui:define>
		
		<ui:define name="pageScripts">
			<script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js" />
			<script>
				$(function(){
					$(".dt-compat").DataTable({"order": [[ 1, "desc" ]]});
				});
			</script>
		</ui:define>
	</ui:composition>
</h:body>

</html>